"use strict";angular.module("posApp",["LocalStorageModule","tmh.dynamicLocale","ui.bootstrap","ngResource","ui.router","ngCookies","pascalprecht.translate","ngCacheBuster","infinite-scroll","ngFileUpload","angularMoment","ngAnimate","toaster","angular-loading-bar","checklist-model","validation.match","nvd3ChartDirectives"]).run(["$rootScope","$location","$window","$http","$state","$translate","Language","Auth","Principal","ENV","VERSION",function(a,b,c,d,e,f,g,h,i,j,k){a.ENV=j,a.VERSION=k,a.$on("$stateChangeStart",function(b,c,d){a.toState=c,a.toStateParams=d,i.isIdentityResolved()&&h.authorize(),g.getCurrent().then(function(a){f.use(a)})}),a.$on("$stateChangeSuccess",function(b,d,e,g,h){var i="global.title";a.previousStateName=g.name,a.previousStateParams=h,d.data.pageTitle&&(i=d.data.pageTitle),f(i).then(function(a){c.document.title=a})}),a.back=function(){"activate"===a.previousStateName||null===e.get(a.previousStateName)?e.go("home"):e.go(a.previousStateName,a.previousStateParams)}}]).config(["$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider","$translateProvider","tmhDynamicLocaleProvider","httpRequestInterceptorCacheBusterProvider",function(a,b,c,d,e,f,g){g.setMatchlist([/.*api.*/,/.*protected.*/],!0),b.otherwise("/"),a.state("site",{"abstract":!0,views:{"navbar@":{templateUrl:"scripts/components/navbar/navbar.html",controller:"NavbarController"}},resolve:{authorize:["Auth",function(a){return a.authorize()}],translatePartialLoader:["$translate","$translatePartialLoader",function(a,b){b.addPart("global")}]}}),c.interceptors.push("errorHandlerInterceptor"),c.interceptors.push("authExpiredInterceptor"),c.interceptors.push("authInterceptor"),c.interceptors.push("notificationInterceptor"),e.useLoader("$translatePartialLoader",{urlTemplate:"i18n/{lang}/{part}.json"}),e.preferredLanguage("vi"),e.useCookieStorage(),e.useSanitizeValueStrategy("escaped"),e.addInterpolation("$translateMessageFormatInterpolation"),f.localeLocationPattern("bower_components/angular-i18n/angular-locale_{{locale}}.js"),f.useCookieStorage(),f.storageKey("NG_TRANSLATE_LANG_KEY")}]),angular.module("posApp").constant("ENV","prod").constant("VERSION","0.0.1-SNAPSHOT").constant("CLOUD","none"),angular.module("posApp").constant("ENV","dev").constant("VERSION","0.0.1-SNAPSHOT").constant("CLOUD","none"),angular.module("posApp").factory("Auth",["$rootScope","$state","$q","$translate","Principal","AuthServerProvider","Account","Register","Activate","Password","PasswordResetInit","PasswordResetFinish","Tracker",function(a,b,c,d,e,f,g,h,i,j,k,l,m){return{login:function(a,b){var g=b||angular.noop,h=c.defer();return f.login(a).then(function(a){return e.identity(!0).then(function(b){d.use(b.langKey),d.refresh(),m.sendActivity(),h.resolve(a)}),g()})["catch"](function(a){return this.logout(),h.reject(a),g(a)}.bind(this)),h.promise},logout:function(){f.logout(),e.authenticate(null)},authorize:function(c){return e.identity(c).then(function(){var c=e.isAuthenticated();a.toState.data.roles&&a.toState.data.roles.length>0&&!e.isInAnyRole(a.toState.data.roles)&&(c?b.go("accessdenied"):(a.returnToState=a.toState,a.returnToStateParams=a.toStateParams,b.go("login")))})},createAccount:function(a,b){var c=b||angular.noop;return h.save(a,function(){return c(a)},function(a){return this.logout(),c(a)}.bind(this)).$promise},updateAccount:function(a,b){var c=b||angular.noop;return g.save(a,function(){return c(a)},function(a){return c(a)}.bind(this)).$promise},activateAccount:function(a,b){var c=b||angular.noop;return i.get(a,function(a){return c(a)},function(a){return c(a)}.bind(this)).$promise},changePassword:function(a,b){var c=b||angular.noop;return j.save(a,function(){return c()},function(a){return c(a)}).$promise},resetPasswordInit:function(a,b){var c=b||angular.noop;return k.save(a,function(){return c()},function(a){return c(a)}).$promise},resetPasswordFinish:function(a,b){var c=b||angular.noop;return l.save(a,function(){return c()},function(a){return c(a)}).$promise}}}]),angular.module("posApp").factory("Principal",["$q","Account","Tracker",function(a,b,c){var d,e=!1;return{isIdentityResolved:function(){return angular.isDefined(d)},isAuthenticated:function(){return e},isInRole:function(a){return e?this.identity().then(function(b){return b.roles&&-1!==b.roles.indexOf(a)},function(a){return!1}):!1},isInAnyRole:function(a){if(!e||!d||!d.roles)return!1;for(var b=0;b<a.length;b++)if(this.isInRole(a[b]))return!0;return!1},authenticate:function(a){d=a,e=null!==a},identity:function(f){var g=a.defer();return f===!0&&(d=void 0),angular.isDefined(d)?(g.resolve(d),g.promise):(b.get().$promise.then(function(a){d=a.data,e=!0,g.resolve(d),c.connect()})["catch"](function(){d=null,e=!1,g.resolve(d)}),g.promise)}}}]),angular.module("posApp").directive("hasAnyRole",["Principal",function(a){return{restrict:"A",link:function(b,c,d){var e=function(){c.removeClass("hidden")},f=function(){c.addClass("hidden")},g=function(b){var c;b&&e(),c=a.isInAnyRole(h),c?e():f()},h=d.hasAnyRole.replace(/\s+/g,"").split(",");h.length>0&&g(!0)}}}]).directive("hasRole",["Principal",function(a){return{restrict:"A",link:function(b,c,d){var e=function(){c.removeClass("hidden")},f=function(){c.addClass("hidden")},g=function(b){b&&e(),a.isInRole(h).then(function(a){a?e():f()})},h=d.hasRole.replace(/\s+/g,"");h.length>0&&g(!0)}}}]),angular.module("posApp").factory("Account",["$resource",function(a){return a("api/account",{},{get:{method:"GET",params:{},isArray:!1,interceptor:{response:function(a){return a}}}})}]),angular.module("posApp").factory("Activate",["$resource",function(a){return a("api/activate",{},{get:{method:"GET",params:{},isArray:!1}})}]),angular.module("posApp").factory("Password",["$resource",function(a){return a("api/account/change_password",{},{})}]),angular.module("posApp").factory("PasswordResetInit",["$resource",function(a){return a("api/account/reset_password/init",{},{})}]),angular.module("posApp").factory("PasswordResetFinish",["$resource",function(a){return a("api/account/reset_password/finish",{},{})}]),angular.module("posApp").factory("Register",["$resource",function(a){return a("api/register",{},{})}]),angular.module("posApp").factory("authInterceptor",["$rootScope","$q","$location","localStorageService",function(a,b,c,d){return{request:function(a){a.headers=a.headers||{};var b=d.get("token");return b&&b.expires_at&&b.expires_at>(new Date).getTime()&&(a.headers.Authorization="Bearer "+b.access_token),a}}}]).factory("authExpiredInterceptor",["$rootScope","$q","$injector","localStorageService",function(a,b,c,d){return{responseError:function(a){if(401===a.status&&("invalid_token"==a.data.error||"Unauthorized"==a.data.error)){d.remove("token");var e=c.get("Principal");if(e.isAuthenticated()){var f=c.get("Auth");f.authorize(!0)}}return b.reject(a)}}}]),angular.module("posApp").factory("errorHandlerInterceptor",["$q","$rootScope",function(a,b){return{responseError:function(c){return(401!=c.status||0!=c.data.path.indexOf("/api/account"))&&b.$emit("posApp.httpError",c),a.reject(c)}}}]),angular.module("posApp").factory("notificationInterceptor",["$q","AlertService",function(a,b){return{response:function(a){var c=a.headers("X-posApp-alert");return angular.isString(c)&&b.success(c,{param:a.headers("X-posApp-params")}),a}}}]),angular.module("posApp").factory("User",["$resource",function(a){return a("api/users/:id",{},{query:{method:"GET",isArray:!0},get:{method:"GET",transformResponse:function(a){return a=angular.fromJson(a)}},update:{method:"PUT"}})}]),angular.module("posApp").filter("characters",function(){return function(a,b,c){if(isNaN(b))return a;if(0>=b)return"";if(a&&a.length>b){if(a=a.substring(0,b),c)for(;" "===a.charAt(a.length-1);)a=a.substr(0,a.length-1);else{var d=a.lastIndexOf(" ");-1!==d&&(a=a.substr(0,d))}return a+"..."}return a}}).filter("words",function(){return function(a,b){if(isNaN(b))return a;if(0>=b)return"";if(a){var c=a.split(/\s+/);c.length>b&&(a=c.slice(0,b).join(" ")+"...")}return a}}),angular.module("posApp").service("Base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.encode=function(b){for(var c,d,e,f,g,h="",i="",j="",k=0;k<b.length;)c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";return h},this.decode=function(b){var c,d,e,f,g,h="",i="",j="",k=0;for(b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");k<b.length;)e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!==g&&(h+=String.fromCharCode(d)),64!==j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j=""}}).factory("StorageService",["$window",function(a){return{get:function(b){return JSON.parse(a.localStorage.getItem(b))},save:function(b,c){a.localStorage.setItem(b,JSON.stringify(c))},remove:function(b){a.localStorage.removeItem(b)},clearAll:function(){a.localStorage.clear()}}}]),angular.module("posApp").factory("AlertService",["$timeout","$sce","$translate",function(a,b,c){function d(){p=[]}function e(){return p}function f(a,b){this.add({type:"success",msg:a,params:b,timeout:q})}function g(a,b){this.add({type:"danger",msg:a,params:b,timeout:q})}function h(a,b){this.add({type:"warning",msg:a,params:b,timeout:q})}function i(a,b){this.add({type:"info",msg:a,params:b,timeout:q})}function j(a){return p.push({type:a.type,msg:b.trustAsHtml(a.msg),id:a.alertId,timeout:a.timeout,close:function(){return n.closeAlert(this.id)}})}function k(b){b.alertId=o++,b.msg=c.instant(b.msg,b.params);var d=this;this.factory(b),b.timeout&&b.timeout>0&&a(function(){d.closeAlert(b.alertId)},b.timeout)}function l(a){return this.closeAlertByIndex(p.map(function(a){return a.id}).indexOf(a))}function m(a){return p.splice(a,1)}var n={factory:j,add:k,closeAlert:l,closeAlertByIndex:m,clear:d,get:e,success:f,error:g,info:i,warning:h},o=0,p=[],q=5e3;return n}]),angular.module("posApp").directive("jhAlert",["AlertService",function(a){return{restrict:"E",template:'<div class="alerts" ng-cloak=""><alert ng-cloak="" ng-repeat="alert in alerts" type="{{alert.type}}" close="alert.close()"><pre>{{ alert.msg }}</pre></alert></div>',controller:["$scope",function(b){b.alerts=a.get(),b.$on("$destroy",function(){b.alerts=[]})}]}}]).directive("jhAlertError",["AlertService","$rootScope","$translate",function(a,b,c){return{restrict:"E",template:'<div class="alerts" ng-cloak=""><alert ng-cloak="" ng-repeat="alert in alerts" type="{{alert.type}}" close="alert.close()"><pre>{{ alert.msg }}</pre></alert></div>',controller:["$scope",function(d){d.alerts=a.get();var e=b.$on("posApp.httpError",function(a,b){var d;switch(a.stopPropagation(),b.status){case 0:f("Server not reachable","error.serverNotReachable");break;case 400:if(b.data&&b.data.fieldErrors)for(d=0;d<b.data.fieldErrors.length;d++){var e=b.data.fieldErrors[d],g=e.field.replace(/\[\d*\]/g,"[]"),h=c.instant("posApp."+e.objectName+"."+g);f("Field "+h+" cannot be empty","error."+e.message,{fieldName:h})}else b.data&&b.data.message?f(b.data.message,b.data.message,b.data):f(b.data);break;default:f(b.data&&b.data.message?b.data.message:JSON.stringify(b))}});d.$on("$destroy",function(){void 0!==e&&null!==e&&e()});var f=function(b,c,d){c=c&&null!=c?c:b,a.error(c,d)}}]}}]),angular.module("posApp").service("ParseLinks",function(){this.parse=function(a){if(0==a.length)throw new Error("input must not be of zero length");var b=a.split(","),c={};return angular.forEach(b,function(a){var b=a.split(";");if(2!=b.length)throw new Error("section could not be split on ';'");var d=b[0].replace(/<(.*)>/,"$1").trim(),e={};d.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(a,b,c,d){e[b]=d});var f=e.page;angular.isString(f)&&(f=parseInt(f));var g=b[1].replace(/rel="(.*)"/,"$1").trim();c[g]=f}),c}}),angular.module("posApp").service("DateUtils",function(){this.convertLocaleDateToServer=function(a){if(a){var b=new Date;return b.setUTCDate(a.getDate()),b.setUTCMonth(a.getMonth()),b.setUTCFullYear(a.getFullYear()),b}return null},this.convertLocaleDateFromServer=function(a){if(a){var b=a.split("-");return new Date(b[0],b[1]-1,b[2])}return null},this.convertDateTimeFromServer=function(a){return a?new Date(a):null}}),angular.module("posApp").config(["$stateProvider",function(a){a.state("error",{parent:"site",url:"/error",data:{roles:[],pageTitle:"error.title"},views:{"content@":{templateUrl:"scripts/app/error/error.html"}},resolve:{mainTranslatePartialLoader:["$translate","$translatePartialLoader",function(a,b){return b.addPart("error"),a.refresh()}]}}).state("accessdenied",{parent:"site",url:"/accessdenied",data:{roles:[]},views:{"content@":{templateUrl:"scripts/app/error/accessdenied.html"}},resolve:{mainTranslatePartialLoader:["$translate","$translatePartialLoader",function(a,b){return b.addPart("error"),a.refresh()}]}})}]),MessageFormat.locale.en=function(a){return 1===a?"one":"other"},MessageFormat.locale.fr=function(a){return 0===a||1==a?"one":"other"},MessageFormat.locale.vi=function(a){return"other"},angular.module("posApp").factory("Language",["$q","$http","$translate","LANGUAGES",function(a,b,c,d){return{getCurrent:function(){var b=a.defer(),d=c.storage().get("NG_TRANSLATE_LANG_KEY");return angular.isUndefined(d)&&(d="vi"),b.resolve(d),b.promise},getAll:function(){var b=a.defer();return b.resolve(d),b.promise}}}]).constant("LANGUAGES",["vi","en","fr"]),angular.module("posApp").controller("LanguageController",["$scope","$translate","Language","tmhDynamicLocale",function(a,b,c,d){a.changeLanguage=function(a){b.use(a),d.set(a)},c.getAll().then(function(b){a.languages=b})}]).filter("findLanguageFromKey",function(){return function(a){return{ca:"Català",da:"Dansk",de:"Deutsch",en:"English",es:"Español",fr:"Français",hu:"Magyar",it:"Italiano",ja:"日本語",kr:"한국어",nl:"Nederlands",pl:"Polski","pt-br":"Português (Brasil)",ro:"Română",ru:"Русский",sv:"Svenska",tr:"Türkçe","zh-cn":"中文（简体）","zh-tw":"繁體中文",vi:"Việt Nam"}[a]}}),angular.module("posApp").factory("AuthServerProvider",["$http","localStorageService","Base64",function(a,b,c){return{login:function(d){var e="username="+encodeURIComponent(d.username)+"&password="+encodeURIComponent(d.password)+"&grant_type=password&scope=read%20write&client_secret=mySecretOAuthSecret&client_id=posapp";return a.post("oauth/token",e,{headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorization:"Basic "+c.encode("posapp:mySecretOAuthSecret")}}).success(function(a){var c=new Date;return c.setSeconds(c.getSeconds()+a.expires_in),a.expires_at=c.getTime(),b.set("token",a),a})},logout:function(){a.post("api/logout").then(function(){b.clearAll()})},getToken:function(){return b.get("token")},hasValidToken:function(){var a=this.getToken();return a&&a.expires_at&&a.expires_at>(new Date).getTime()}}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("tracker",{parent:"admin",url:"/tracker",data:{roles:["ROLE_ADMIN"],pageTitle:"tracker.title"},views:{"content@":{templateUrl:"scripts/app/admin/tracker/tracker.html",controller:"TrackerController"}},resolve:{mainTranslatePartialLoader:["$translate","$translatePartialLoader",function(a,b){return b.addPart("tracker"),a.refresh()}]},onEnter:["Tracker",function(a){a.subscribe()}],onExit:["Tracker",function(a){a.unsubscribe()}]})}]),angular.module("posApp").controller("TrackerController",["$scope","AuthServerProvider","$cookies","$http","Tracker",function(a,b,c,d,e){function f(b){for(var c=!1,d=0;d<a.activities.length;d++)a.activities[d].sessionId==b.sessionId&&(c=!0,"logout"==b.page?a.activities.splice(d,1):a.activities[d]=b);c||"logout"==b.page||a.activities.push(b)}a.activities=[],e.receive().then(null,null,function(a){f(a)})}]),angular.module("posApp").factory("Tracker",["$rootScope","$cookies","$http","$q","localStorageService",function(a,b,c,d,e){function f(){null!=g&&g.connected&&g.send("/topic/activity",{},JSON.stringify({page:a.toState.name}))}var g=null,h=null,i=d.defer(),j=d.defer(),k=!1;return{connect:function(){var d=window.location,h="//"+d.host+d.pathname+"websocket/tracker",i=e.get("token");i&&i.expires_at&&i.expires_at>(new Date).getTime()&&(h+="?access_token="+i.access_token);var l=new SockJS(h);g=Stomp.over(l);var m={};m["X-CSRF-TOKEN"]=b[c.defaults.xsrfCookieName],g.connect(m,function(b){j.resolve("success"),f(),k||(a.$on("$stateChangeStart",function(a){f()}),k=!0)})},subscribe:function(){j.promise.then(function(){h=g.subscribe("/topic/tracker",function(a){i.notify(JSON.parse(a.body))})},null,null)},unsubscribe:function(){null!=h&&h.unsubscribe()},receive:function(){return i.promise},sendActivity:function(){null!=g&&f()},disconnect:function(){null!=g&&(g.disconnect(),g=null)}}}]),angular.module("posApp").factory("Utils",["$location","$window","AuthServerProvider",function(a,b,c){var d={isUndefinedOrNull:function(a){return angular.isUndefined(a)||null===a},isInt:function(a){return Number(a)===a&&a%1===0},isFloat:function(a){return a===Number(a)&&a%1!==0},openTab:function(c){var d=a.absUrl().length-a.path().length,e=a.absUrl().substring(0,d);e=e.concat(c),b.open(e,"_blank")},downloadReport:function(d,e){var f=a.absUrl().length-a.path().length,g=a.absUrl().substring(0,f-1);g=g.concat("api/report").concat(d),g=g.concat("?access_token=").concat(c.getToken().access_token),b.open(g,"_blank")}};return d}]).constant("Constants",{orderStatus:{cancel:"CANCEL",hold:"HOLD",payment:"PAYMENT"},dateTimePattern:"DD/MM/YYYY HH:mm:ss",fractionSize:2,perPage:6,all:"ALL",perCategory:5,perItem:24,openShift:"openshift"}),angular.module("posApp").run(["$rootScope","Constants",function(a,b){a.constants=b}]),angular.module("posApp").directive("numberFormat",["$filter","Utils","Constants",function(a,b,c){return{restrict:"A",link:function(d,e,f){d.$watch(f.numberFormat,function(d){!b.isUndefinedOrNull(d)&&angular.isNumber(d)&&(b.isInt(d)?e.text(a("number")(d,0)):b.isFloat(d)&&e.text(a("number")(d,c.fractionSize)))})}}}]).directive("userAuthority",["$filter","Utils","Constants",function(a,b,c){return{restrict:"A",link:function(a,c,d){a.$watch(d.userAuthority,function(a){if(!b.isUndefinedOrNull(a)&&a.length>0){var d=[];angular.forEach(a,function(a){d.push(a.name)}),d.length>0&&c.text(d.join(","))}})}}}]),angular.module("posApp").factory("OrderService",["$http",function(a){return{createOrder:function(b){return a.post("/api/orders",b)},updateOrder:function(b){return a.put("/api/orders",b)},getById:function(b){var c="api/orders/"+b;return a.get(c)},getByTableIdStatusCreatedDate:function(b,c,d,e,f,g){return a.get("api/orders",{params:{page:b,per_page:c,tableId:d,status:e,from:f,to:g}})},getSumReceivableAmountByStatusCreatedDate:function(b,c,d){return a.get("api/orders/receivable-amount",{params:{status:b,from:c,to:d}})},moveItem:function(b){return a.post("/api/orders/move",b)}}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("print",{parent:"site",url:"/print/{id}",data:{roles:[],pageTitle:"print.title"},views:{"content@":{templateUrl:"scripts/app/print/print.html",controller:"PrintController"}},resolve:{mainTranslatePartialLoader:["$translate","$translatePartialLoader",function(a,b){return b.addPart("common"),b.addPart("order"),b.addPart("print"),a.refresh()}]}})}]),angular.module("posApp").controller("PrintController",["$scope","$filter","$stateParams","$window","$timeout","toaster","Principal","Constants","Utils","OrderService",function(a,b,c,d,e,f,g,h,i,j){a.order={},a.load=function(b){j.getById(b).then(function(b){i.isUndefinedOrNull(b)||(a.order=b.data,e(function(){d.print()},1e3))})},a.load(c.id)}]);